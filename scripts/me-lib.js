const log=function(t){console.log("[LIB INFO] "+t)},log_obj=function(t){console.dir(t,{depth:null})},POOL_SIZE_MAX=21,TAPOS_EXPIRY_S=3600;function make_live_stream_url(t){}const BOOTSTRAP_INFO_EOS_MAINNET={name:"EOS_MAINNET",chain_id:"aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906",bootstrap_ap_list:[{url:"https://eos.eoscafeblock.com",valid:!0}],live_stream_url:function(t){return"https://eosauthority.com/account/"+t+"#transactions"},chain_name:""},BOOTSTRAP_INFO_TELOS_MAINNET={name:"TELOS_MAINNET",chain_id:"4667b205c6838ef70ff7988f6e8257e8be0e1284a2f59699054a018f743b1d11",bootstrap_ap_list:[{url:"https://telos.greymass.com",valid:!0},{url:"https://telos.caleos.io",valid:!0},{url:"https://api.eos.miami",valid:!0},{url:"https://api.telos.telosgreen.com",valid:!0},{url:"https://api.telosmadrid.io",valid:!0},{url:"https://telos.cryptosuvi.io",valid:!0}],history_ap_list:[{url:"https://mainnet.telos.net",valid:!0}],live_stream_url:function(t){return"https://eosauthority.com/account/"+t+"?network=telos#transactions"},chain_name:""},BOOTSTRAP_INFO_TELOS_TESTNET={name:"TELOS_TESTNET",chain_id:"1eaa0824707c8c16bd25145493bf062aecddfeb56c736f6ba6397f3195f33c9f",bootstrap_ap_list:[{url:"https://testnet.telos.caleos.io",valid:!0},{url:"https://testnet.eos.miami",valid:!0}],history_ap_list:[{url:"https://testnet.telos.net",valid:!0}],live_stream_url:function(t){return"https://eosauthority.com/account/"+t+"?network=telostest#transactions"},chain_name:"testnet"};var g_API,g_RPCIdx,g_rpcApiPool=[],g_historyApiPool=[],g_bootstrapInfo=BOOTSTRAP_INFO_TELOS_MAINNET,g_tapos=null,g_taposExpirySec=3600,g_ActiveAirContract="airv11.meas",g_ActiveGwContract="gwv11.meas",g_RPC=null;function getRpc(){for(let t=0;t<g_rpcApiPool.length;t++)if(g_rpcApiPool[t].valid)return t===g_RPCIdx&&null!==g_RPC||(g_RPC=new eosjs_jsonrpc.JsonRpc(g_rpcApiPool[t].url),g_RPCIdx=t,log("New RPC "+t)),log("RPC: "+g_rpcApiPool[t].url),g_RPC;return log("No valid RPC could be found"),null}var g_HistoryIdx,g_History=null;function getHistoryReq(){for(let t=0;t<g_historyApiPool.length;t++)if(g_historyApiPool[t].valid)return t===g_HistoryIdx&&null!==g_History||(g_History=g_historyApiPool[t].url,g_HistoryIdx=t,log("New History "+t)),log("History: "+g_History),g_History;return log("No valid History could be found"),null}function invalidateRpc(){g_RPCIdx>=0&&(log("Invalidating RPC "+g_RPCIdx),g_rpcApiPool[g_RPCIdx].valid=!1)}function invalidateHistory(){g_HistoryIdx>=0&&(log("Invalidating History "+g_HistoryIdx),g_historyApiPool[g_HistoryIdx].valid=!1)}async function buildRpcApiPool(t){log("Build RPC pool from: "+(g_bootstrapInfo="testnet"===t?BOOTSTRAP_INFO_TELOS_TESTNET:BOOTSTRAP_INFO_TELOS_MAINNET).name);g_bootstrapInfo.chain_id;for(const t of g_bootstrapInfo.bootstrap_ap_list)if(g_rpcApiPool.push(t),log("pushing '"+t+"' ("+g_rpcApiPool.length+")"),g_rpcApiPool.length==POOL_SIZE_MAX)return null;return null}async function buildHistoryApiPool(){for(const t of g_bootstrapInfo.history_ap_list)g_historyApiPool.push(t),log("pushing '"+t+"' ("+g_historyApiPool.length+")")}function getBootstrapInfo(t){let o=null;return t===CHAIN_ID_EOS_MAINNET?o=BOOTSTRAP_INFO_EOS_MAINNET:t===CHAIN_ID_TELOS_MAINNET?o=BOOTSTRAP_INFO_TELOS_MAINNET:t===CHAIN_ID_TELOS_TESTNET&&(o=BOOTSTRAP_INFO_TELOS_TESTNET),o}var moduleInited=!1;async function me_lib_init(t){g_tapos=await buildRpcApiPool(t),await buildHistoryApiPool(),moduleInited=!0}async function me_lib_map_summary(t){await me_lib_getSummaryData(t)}async function getSummaryData(t,o){let e;for(log("get "+t+" summary data");null!==(e=getRpc());)try{var i=(await e.get_table_rows({json:!0,code:t,scope:t,table:"summarytable",limit:100})).rows;for(var a in i){var r=i[a];me_map_add(r,g_bootstrapInfo.live_stream_url,o.inactive)}break}catch(t){invalidateRpc();continue}}async function me_lib_getSummaryData(t){try{me_map_clear(),await getSummaryData(g_ActiveAirContract,t)}catch(t){t instanceof eosjs_jsonrpc.RpcError?log(JSON.stringify(t.json,null,2)):log(t)}}async function me_lib_getDeviceData(t){let o;for(;null!==(o=getRpc());)try{log("get device data: "+t+" from "+g_ActiveAirContract);const e=await o.get_table_rows({json:!0,code:g_ActiveAirContract,scope:g_ActiveAirContract,table:"datatable",lower_bound:t,upper_bound:t,limit:1});return e&&e.rows&&e.rows.length>0?e.rows[0]:(log("error: no data for "+t),{})}catch(t){t instanceof eosjs_jsonrpc.RpcError?log(JSON.stringify(t.json,null,2)):log(t),invalidateRpc();continue}}async function me_lib_getDeviceDataNDay(t,o){(!o||o<1)&&(o=1);let e=await me_lib_getDeviceData(t);if(!e.account)return{};let i={};i.account=e.account,i.fw_version=e.fw_version,i.stream_id=e.stream_id,i.update_period_s=e.update_period_s,i.extended_status=e.extended_status,i.head_rec_idx=0,i.rec_q=[],i.num_rec=0;let r=new Date;r.setDate(r.getDate()-o);let n,_=0,l=0;for(log("get device data: "+t+" for "+o+" days starting: "+r.toISOString());null!==(n=getHistoryReq());){do{try{let o=n+"/v2/history/get_actions?account="+t+"&act.name=submitv1&simple=true&after="+r.toISOString()+"&sort=1&limit=1000&skip="+_;log("Making request: "+o);let e=await fetch(o),s=await e.json();if(!s.simple_actions)break;for(a in _+=s.simple_actions.length,i.num_rec+=s.simple_actions.length,s.simple_actions){let t=s.simple_actions[a];i.rec_q.push(t.data.record)}l=s.total.value,log("Got "+i.num_rec+" / "+l+" records")}catch(t){log(t),invalidateHistory();break}}while(0);if(_>=l)break}return i.rec_q&&i.rec_q.length>1&&i.rec_q.unshift(i.rec_q.pop()),i}function me_lib_ext(){return"meas"}const ME_TYPE_NONE=0,ME_TYPE_AIR=1,ME_TYPE_GW=2;function me_lib_type(t){if(t){if(t.startsWith("a"))return ME_TYPE_AIR;if(t.startsWith("g"))return ME_TYPE_GW}return ME_TYPE_NONE}function me_lib_type_ver(t){let o="0";if(t){let e=t.charCodeAt(1);e>="1".charCodeAt(0)&&e<="5".charCodeAt(0)?o=String.fromCharCode(e):e>="a".charCodeAt(0)&&e<="z".charCodeAt(0)&&(o=String.fromCharCode("6".charCodeAt(0)+(e-"a".charCodeAt(0))))}return o}function me_lib_get_chain_param(t){let o="&";return t&&(o="?"),g_bootstrapInfo.chain_name&&""!==g_bootstrapInfo.chain_name?o+"chain="+g_bootstrapInfo.chain_name:""}