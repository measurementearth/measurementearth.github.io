function me_plot_init(){}function me_plot_station(e,t){me_plot(e,t)}function addData(e,t,a){e.data.labels.push(t),e.data.datasets.forEach(e=>{e.data.push(a)}),e.update()}const CHART_DS_BATT=0,CHART_COLOR_RED=0,CHART_COLOR_BLUE=1,CHART_COLOR_YELLOW=2,CHART_COLOR_GREEN=3,CHART_COLOR_BRIGHT_GREEN=4,CHART_COLOR_PURPLE=5,CHART_COLOR_ORANGE=6,CHART_COLOR_ORANGE1=7,CHART_COLOR_ORANGE2=8,CHART_COLOR_ORANGE3=9,CHART_COLOR_VIOLET=10,COLOR=["rgba(255, 99, 132,","rgba(54, 162, 235,","rgba(255, 206, 86,","rgba(75, 192, 192,","rgba(25, 212, 63,","rgba(153, 102, 255,","rgba(255, 159, 74,","rgba(255, 179, 84,","rgba(255, 199, 94,","rgba(255, 219, 104,","rgba(153, 172, 255,"];function getColor(e,t){return e<COLOR.length?(void 0===t&&(t=1),COLOR[e]+t+")"):"rgb(128,128,128)"}let width,height,gradient;function getGradient(e,t,a,r){const o=a.right-a.left,n=a.bottom-a.top;if(null===gradient||width!==o||height!==n){width=o,height=n,gradient=t.createLinearGradient(0,a.bottom,0,a.top);let s=100/e.chart.scales.y.max,l=.09*s,i=.1*s,d=.19*s,g=.2*s;gradient.addColorStop(0,getColor(CHART_COLOR_BRIGHT_GREEN,r)),gradient.addColorStop(l,getColor(CHART_COLOR_BRIGHT_GREEN,r)),gradient.addColorStop(i,getColor(CHART_COLOR_YELLOW,r)),gradient.addColorStop(d,getColor(CHART_COLOR_YELLOW,r)),gradient.addColorStop(g,getColor(CHART_COLOR_RED,r)),gradient.addColorStop(.99,getColor(CHART_COLOR_RED,r));let _=e.dataset.data[e.dataset.data.length-1];_<10?gradient.addColorStop(1,getColor(CHART_COLOR_BRIGHT_GREEN,r)):_<20?gradient.addColorStop(1,getColor(CHART_COLOR_YELLOW,r)):gradient.addColorStop(1,getColor(CHART_COLOR_RED,r))}return gradient}function getPMBorderGradient(e){const t=e.chart,{ctx:a,chartArea:r}=t;return r?getGradient(e,a,r,1):null}function getPMBorderGradientBG(e){const t=e.chart,{ctx:a,chartArea:r}=t;return r?getGradient(e,a,r,.5):null}function getLineColorData(e,t){return getColor(e<10?CHART_COLOR_BRIGHT_GREEN:e<20?CHART_COLOR_YELLOW:CHART_COLOR_RED,t)}const CHART_DATA={batt:{type:"line",labels:["battery level"],axisLabels:["millivolts (mv)"],positions:["left"],mins:[3e3],maxs:[4500],borderColors:[getColor(CHART_COLOR_RED)],backgroundColors:[getColor(CHART_COLOR_RED,.5)]},temp:{type:"line",labels:["temperature"],axisLabels:["Celsius (C)"],positions:["left"],mins:[-40],maxs:[80],borderColors:[getColor(3)],backgroundColors:[getColor(3,.5)]},pres:{type:"line",labels:["Pressure"],axisLabels:["Hectopascals (hPa)"],positions:["left"],mins:[850],maxs:[950],borderColors:[getColor(1)],backgroundColors:[getColor(1,.5)]},hum:{type:"line",labels:["Humidity"],axisLabels:["Relative Humidity (%)"],positions:["left"],mins:[0],maxs:[100],borderColors:[getColor(CHART_COLOR_YELLOW)],backgroundColors:[getColor(CHART_COLOR_YELLOW,.5)]},pm:{type:"line",labels:["PM 1.0","PM 2.5","PM 4.0","PM 10.0"],axisLabels:["ug/m3"],positions:["left"],mins:[0],maxs:[100],borderColors:[getPMBorderGradient,getPMBorderGradient,getPMBorderGradient,getPMBorderGradient],backgroundColors:[getPMBorderGradientBG,getPMBorderGradientBG,getPMBorderGradientBG,getPMBorderGradientBG]},link:{type:"line",labels:["RSSI","SNR"],axisLabels:["RSSI (dBm)","SNR"],positions:["left","right"],mins:[-140,-20],maxs:[0,10],borderColors:[getColor(5),getColor(10)],backgroundColors:[getColor(5,.5),getColor(10,.5)]},orient:{type:"line",labels:["x","y","z"],axisLabels:["milli-g"],positions:["left"],mins:[-1200],maxs:[1200],borderColors:[getColor(CHART_COLOR_RED),getColor(3),getColor(1)],backgroundColors:[getColor(CHART_COLOR_RED,.5),getColor(3,.5),getColor(1,.5)]}};function generateChart(e,t,a,r){let o="chart_"+e.replaceAll(" ","_");var n=CHART_DATA[t];let s={labels:a,datasets:[]},l={x:{title:{display:!0,text:"Time"}}};const i=["y","y1","y2","y3"];let d=0;for(let e in r){console.log(" i, index "+e+" "+d+" "+r[e][0]);let t={label:n.labels[e],data:r[e],borderColor:n.borderColors[e],backgroundColor:n.backgroundColors[e],yAxisID:i[d]};s.datasets.push(t);let a={suggestedMin:n.mins[d],suggestedMax:n.maxs[d],display:!0,title:{display:!0,text:n.axisLabels[d]},position:n.positions[d]};"y"!==i[d]&&(a.grid={drawOnChartArea:!1}),l[i[d]]=a,d+1<n.axisLabels.length&&d++}var g=document.getElementById(o).getContext("2d");new Chart(g,{type:n.type,data:s,options:{plugins:{legend:{position:"top"},title:{display:!0,text:e}},scales:l}})}function processData(e,t){0}function generate_air_records(e,t){let a=document.getElementById("charts");a.innerHTML+='<canvas id="chart_Particle" ></canvas>',a.innerHTML+='<canvas id="chart_Temperature" ></canvas>',a.innerHTML+='<canvas id="chart_Pressure" ></canvas>',a.innerHTML+='<canvas id="chart_Humidity" ></canvas>',a.innerHTML+='<canvas id="chart_Battery_Level" ></canvas>',a.innerHTML+='<canvas id="chart_Link" ></canvas>',a.innerHTML+='<canvas id="chart_Orientation" ></canvas>';let r=e.head_rec_idx,o=e.rec_q,n=e.stream_id,s=e.num_rec,l=o.length,i=e.update_period_s/60;if(log_obj(e),console.log("air data"),0===l)return void(document.getElementById("stream_id").innerHTML="Stream ID: <b><i>no data</i></b>");let d=new Date;d.setTime(1e3*o[0].timestamp),console.log(o[0].timestamp+" "+d);const g=[],_=[],u=[],p=[],m=[],c=[],C=[],h=[],R=[],L=[],b=[],O=[],T=[],H=[];let A=0;s===l&&(A=r+1)===s&&(A=0),log("head: "+r+" tail: "+A);new Date(1e3*o[A].timestamp),new Date(1e3*o[r].timestamp);let y=(o[r].timestamp-o[A].timestamp)/3600,E=0,B=0,G=0;for(let t=0;t<s;++t){let a=A+t;a>=s&&(a-=s);let r=new Date(1e3*o[a].timestamp),[n,l,d,y]=r.toDateString().split(" "),M=r.toTimeString().split(" ");if(0===E)E=o[A].record_id,B=o[A].stream_id,G=o[A].timestamp;else{if(o[a].record_id>E+1||o[a].stream_id!=B){let e=o[a].record_id-E-1;o[a].stream_id!=B&&(e=(o[a].timestamp-G)/60/i,log("stream change: "+o[a].stream_id+" > "+B)),console.log("missing: "+e+" starting at "+(E+1)+" stream:"+o[a].stream_id);for(let t=0;t<e;t++)g.push("missing "),_.push(null),u.push(null),p.push(null),m.push(null),C.push(null),c.push(null),h.push(null),R.push(null),L.push(null),b.push(null),O.push(null),T.push(null),H.push(null)}E=o[a].record_id,B=o[a].stream_id,G=o[a].timestamp}let x=32&o[a].board.status;g.push([l+" "+d,M[0],o[a].record_id]),x&&0===o[a].chassis.particle.pm1_0_ug_m3&&0===o[a].chassis.particle.pm2_5_ug_m3&&0===o[a].chassis.particle.pm4_0_ug_m3&&0===o[a].chassis.particle.pm10_0_ug_m3?(h.push(null),R.push(null),L.push(null),b.push(null)):(h.push(o[a].chassis.particle.pm1_0_ug_m3),R.push(o[a].chassis.particle.pm2_5_ug_m3),L.push(o[a].chassis.particle.pm4_0_ug_m3),b.push(o[a].chassis.particle.pm10_0_ug_m3)),_.push(o[a].board.batt_mv),u.push(o[a].chassis.temperature_c),p.push(o[a].board.pressure_hpa),m.push(o[a].chassis.humidity_rh),C.push(o[a].board.rssi),c.push(o[a].board.snr),me_map_plot_record(e.account,o[a]),x&&0===o[a].board.orientation.x&&0===o[a].board.orientation.y&&0===o[a].board.orientation.z?(O.push(null),T.push(null),H.push(null)):(O.push(o[a].board.orientation.x),T.push(o[a].board.orientation.y),H.push(o[a].board.orientation.z))}document.getElementById("time_period").innerHTML="Time period: "+y.toFixed(1)+" hours";let M='Most recent: <span style="background-color:',x=getLastSeenSec({last_seen:o[r].timestamp})/60;M+=x<=i?'lightgreen">':x<=3*i?'yellow">':'red">',M+="&nbsp;"+getLastSeen({last_seen:o[r].timestamp}).description+"&nbsp;</span>",document.getElementById("last_seen").innerHTML=M,document.getElementById("interval").innerHTML="Interval: "+i+" minutes",document.getElementById("stream_id").innerHTML="Stream ID: "+n;CHART_DATA.pm;let D=R[R.length-1],f='<span style="background-color:'+(D<10?'lightgreen">':D<20?'yellow">':'red">')+"&nbsp;"+D+"&nbsp;</span> &mu;g/m<sup>3</sup>",v=u[u.length-1]+" &deg;C",S=p[p.length-1]+" hPa",I=m[m.length-1]+" %RH",P=_[_.length-1]+" mV";document.getElementById("last_data").innerHTML="Data Summary: "+f+" | "+v+" | "+S+" | "+I+" | "+P;let k=(new Date).toLocaleString();document.getElementById("page_generated").innerHTML="(Page generated: "+k+")",generateChart("Particle","pm",g,[h,R,L,b]),generateChart("Battery Level","batt",g,[_]),generateChart("Temperature","temp",g,[u]),generateChart("Pressure","pres",g,[p]),generateChart("Humidity","hum",g,[m]),generateChart("Link","link",g,[C,c]),generateChart("Orientation","orient",g,[O,T,H]),zoomPoints(1)}function generate_datasets(e,t){let a=[];switch(log("generate data for"+e.account),me_lib_type(e.account)){case ME_TYPE_AIR:a=generate_air_records(e,t)}return a}function me_plot(e,t){document.getElementById("station_id").innerHTML="Station ID: scanning...";let a={};(a=t?me_lib_getDeviceDataNDay(e,t):me_lib_getDeviceData(e)).then(t=>{let a=t.account;void 0===a&&(a="<b>not found:</b> "+e),document.getElementById("station_id").innerHTML="Station ID: "+a;generate_datasets(t);console.log("gen data")})}